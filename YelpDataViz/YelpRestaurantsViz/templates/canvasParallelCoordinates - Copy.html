{% load staticfiles %}
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <title>Yelp Data Viz</title>
    <style type="text/css">
	#map{ height: 90%; width: 50%;	}
body { 
  font-family: sans-serif;
  font-size: 12px;
  background: #f9f9f9;
  color: #777;
}

body.dark {
  background: #090909;
  color: #ccc;
}

#wrap {
  width: 300px;
  margin: 0 auto;
  position: relative;
}

svg {
  font: 10px sans-serif;
}

canvas, svg {
  position: absolute;
  top: 0;
  left: 0;
}

#chart {
  position: relative;
}

.brush .extent {
  fill: rgba(0,0,0,0.12);
  stroke: rgba(255,255,255,0.6);
  shape-rendering: crisp-edges;
}

.dark .brush .extent {
  fill: rgba(255,255,255,0.12);
  stroke: rgba(0,0,0,0.5);
}

.axis line, .axis path {
  fill: none;
  stroke: #222;
  shape-rendering: crispEdges;
}

.axis text {
  fill: #222;
  text-shadow: 1px 1px 1px #fff, -1px -1px 1px #fff;
}

.axis text.label {
  fill: #444;
  font-size: 14px;
}

.dark .axis text {
  fill: #f2f2f2;
  text-shadow: 0 1px 0 #000, 1px 0 0 #000;
}

.dark .axis text.label {
  fill: #ddd;
}

.axis g,
.axis path {
  display: none;
}

#food-list {
  position: absolute;
  left: 250px;
  width: 740px;
  overflow-x: hidden;
}
#food-list span {
  display: inline-block;
  height: 6px;
  width: 6px;
  margin: 2px 4px;
}
    </style>
  </head>
  <body>
    <div class="row">
        <div class="col-md-6" id="map" style='height:600px; width:700px; border: 3px solid #73AD21;'>
            Map place
        </div>
        <div class="col-md-6" id="wrap" style='height:600px; width:840px; border: 3px solid #73AD21;'>
              {% csrf_token %}
			<div class="btn-group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select a City <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    {% for city in cities %}
                    <li><a href="{% url 'selectCity' cityname=city %}" name=city value=city>{{city}}</a></li>
                    {% endfor %}
                </ul>
            </div>
      <h1>{{ selectedCityName }}</h1>
		<div id="chart">
			<canvas id="foreground"></canvas>
			<svg></svg>
		</div>
    <div id="food-list"></div>
	<div id="color encoding">
	</div>
    <p>
    Rendered: <strong id="rendered-count"></strong><br/>
    Selected: <strong id="selected-count"></strong><br/>
    Opacity: <strong id="opacity"></strong><br/>
    <button id="hide-ticks">Hide Ticks</button>
    <button id="show-ticks">Show Ticks</button><br/>
    <button id="dark-theme">Dark</button>
    <button id="light-theme">Light</button>
    </p>
    <p>
      Drag along a vertical axis to brush<br/>
      Tap the axis to remove its brush                                          
    </p>
    </div>
    </div>
    <script src="http://mbostock.github.com/d3/d3.v2.js"></script>
    <script src="{% static 'js/parallel.js' %}"></script>
    <script type="text/javascript">
		
		var selectedCity = "{{ selectedCityName }}";
		var latitude = "{{ selectedCityLatitude }}";
		var longitude = "{{ selectedCityLongitude }}";
		// initialize the map
		var map = L.map('map').setView([latitude, longitude], 12);

		// load a tile layer
		L.tileLayer( 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
			maxZoom: 30,
			minZoom: 1,
			attribution: 'Map data &copy;',
			id: 'mapbox.streets'
		  }).addTo(map);

		  // load GeoJSON from an external file
		$.getJSON("/static/data/"+selectedCity+"Restaurants.geojson",function(data){

		  var restIcon = L.icon({
			  iconUrl: '/static/img/rest_icon.png',
			  iconSize: [15,15]
			});
			
			L.geoJson(data,{
			  pointToLayer: function(feature,latlng){
				var marker = L.marker(latlng,{icon: restIcon});
				marker.bindPopup(feature.properties.name + '<br/>' + 'Stars: '+ feature.properties.stars+ '</br>'+feature.properties.cuisine);
				return marker;
			  }
			}).addTo(map);
		  });
		console.log("executed map stuff");
        console.log(selectedCity);
        drawCanvasParallelCoordinates(selectedCity);
    </script>
  </body>
</html>
